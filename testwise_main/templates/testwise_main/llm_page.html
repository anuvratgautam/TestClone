{% extends 'base_dashboard.html' %}

{% block content %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <h1 class="display-6 mb-0">Your Uploaded PDFs</h1>
        <button class="btn btn-primary rounded-pill" onclick="location.href='{% url 'pdf_list' %}'">
            <i class="fas fa-plus me-2"></i>Upload New
        </button>
    </div>
    
    {% if messages %}
    <div class="alert alert-info alert-dismissible fade show rounded-4 border-0 shadow-sm">
        {% for message in messages %}
            <p class="mb-0">{{ message }}</p>
        {% endfor %}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}
    
    {% if user_pdfs %}
        <div class="pdf-list">
            {% for pdf in user_pdfs %}
            <div class="pdf-item mb-3">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                    <div class="card-header border-0 bg-white p-0">
                        <button class="d-flex justify-content-between align-items-center w-100 btn btn-link text-decoration-none text-dark p-4"
                                data-bs-toggle="collapse"
                                data-bs-target="#pdf{{ forloop.counter }}"
                                aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}">
                            <div class="d-flex align-items-center gap-3">
                                <div class="pdf-icon-wrapper bg-primary bg-opacity-10 rounded-3 p-2">
                                    <i class="fas fa-file-pdf text-primary fs-4"></i>
                                </div>
                                <div class="pdf-info">
                                    <h5 class="mb-1">{{ pdf.title }}</h5>
                                    <small class="text-muted">Updated {{ pdf.analyzed_at|date:"F j, Y" }}</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-3">
                                <span class="badge bg-primary rounded-pill">PDF {{ forloop.counter }}</span>
                                <i class="fas fa-chevron-down transition-transform"></i>
                            </div>
                        </button>
                    </div>
                    
                    <div id="pdf{{ forloop.counter }}" 
                         class="collapse {% if forloop.first %}show{% endif %}"
                         data-bs-parent=".pdf-list">
                        <div class="card-body p-4">
                            <div class="row">
                                <div class="col-md-8">
                                    {% if pdf.analysis %}
                                        <div class="analysis-content">
                                            <div class="d-flex justify-content-between align-items-center mb-4">
                                                <h6 class="text-uppercase text-muted fw-bold mb-0">Academic Analysis</h6>
                                                <a href="{{ pdf.pdf_file.url }}" 
                                                   class="btn btn-outline-primary btn-sm rounded-pill"
                                                   target="_blank">
                                                    <i class="fas fa-external-link-alt me-2"></i>Open PDF
                                                </a>
                                            </div>
                                            <div class="analysis-text">
                                                {{ pdf.analysis|linebreaks }}
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="text-center py-5">
                                            <div class="spinner-grow text-primary mb-3" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p class="text-muted mb-0">Analyzing your document...</p>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-4">
                                    <div class="action-sidebar p-3 bg-light rounded-4">
                                        <h6 class="text-uppercase text-muted fw-bold mb-3">Actions</h6>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-primary rounded-3" onclick="generateQuestions({{ forloop.counter }})">
                                                <i class="fas fa-question-circle me-2"></i>Generate Questions
                                            </button>
                                            <button class="btn btn-outline-primary rounded-3" onclick="explainConcepts({{ forloop.counter }})">
                                                <i class="fas fa-lightbulb me-2"></i>Explain Concepts
                                            </button>
                                            <button class="btn btn-outline-secondary rounded-3" onclick="downloadSummary({{ forloop.counter }})">
                                                <i class="fas fa-download me-2"></i>Download Summary
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-5">
            <div class="empty-state mb-4">
                <i class="fas fa-file-upload fs-1 text-muted"></i>
            </div>
            <h5 class="mb-3">No PDFs uploaded yet</h5>
            <p class="text-muted mb-4">Start by uploading your first PDF document</p>
            <a href="{% url 'pdf_list' %}" class="btn btn-primary rounded-pill px-4">
                <i class="fas fa-plus me-2"></i>Upload PDF
            </a>
        </div>
    {% endif %}
</div>

<style>
:root {
    --primary-color: #0d6efd;
    --transition-speed: 0.2s;
}

.transition-transform {
    transition: transform var(--transition-speed) ease;
}

.collapse.show + .card-body .fa-chevron-down {
    transform: rotate(180deg);
}

.pdf-item .card {
    transition: transform var(--transition-speed) ease;
}

.pdf-item .card:hover {
    transform: translateY(-2px);
}

.analysis-text {
    font-size: 0.95rem;
    line-height: 1.7;
    color: #4a5568;
}

.action-sidebar {
    position: sticky;
    top: 1rem;
}

.btn {
    padding: 0.625rem 1rem;
    font-weight: 500;
}

.btn-link:focus {
    box-shadow: none;
}

.empty-state i {
    opacity: 0.5;
}

@media (max-width: 768px) {
    .action-sidebar {
        margin-top: 2rem;
        position: static;
    }
}

/* Modern scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
}

::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: #666;
}
</style>

{% block extra_js %}
<script>
const functions = {
    generateQuestions: (pdfId) => {
        console.log('Generating questions for PDF:', pdfId);
    },
    
    explainConcepts: (pdfId) => {
        console.log('Explaining concepts for PDF:', pdfId);
    },
    
    downloadSummary: (pdfId) => {
        console.log('Downloading summary for PDF:', pdfId);
    }
};

// Bind functions to window object
Object.entries(functions).forEach(([key, value]) => {
    window[key] = value;
});

// Add smooth collapse animation
document.addEventListener('DOMContentLoaded', () => {
    const triggers = document.querySelectorAll('[data-bs-toggle="collapse"]');
    triggers.forEach(trigger => {
        trigger.addEventListener('click', (e) => {
            const icon = trigger.querySelector('.fa-chevron-down');
            icon.style.transform = trigger.getAttribute('aria-expanded') === 'true' 
                ? 'rotate(0deg)' 
                : 'rotate(180deg)';
        });
    });
});
</script>
{% endblock %}
{% endblock %}